<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Profile - SheIsMe</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-pink-50 min-h-screen flex flex-col items-center p-8">

<!-- üîô Back Button -->
<button onclick="window.history.back()" 
        class="self-start mb-4 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg">
  ‚Üê Back
</button>

<h1 class="text-3xl font-bold text-pink-700 mb-6">Your Cart</h1>

<!-- üéÄ Selected Product Section -->
<div id="selected-product" class="mb-10 text-center"></div>

<!-- üõçÔ∏è All Products Section -->
<h2 class="text-2xl text-gray-700 mb-4">All Available Products</h2>
<div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>

<!-- üõí Cart Display -->
<h2 class="text-2xl text-gray-700 mt-10 mb-4">Session Cart</h2>
<div id="cart-items" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full max-w-5xl"></div>

<script>
// --- Get selected image from URL ---
const params = new URLSearchParams(window.location.search);
const selectedImage = params.get('image');

// --- Get all product data from localStorage ---
const allProducts = JSON.parse(localStorage.getItem('productData')) || [];

// --- References ---
const selectedProductDiv = document.getElementById('selected-product');
const productList = document.getElementById('product-list');
const cartItemsDiv = document.getElementById('cart-items');

// --- Retrieve or create cart from session ---
let cart = JSON.parse(sessionStorage.getItem('cart')) || [];

// ‚úÖ Save cart
function saveCart() {
  sessionStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
}

// ‚úÖ Add to Cart or Increase Quantity
function addToCart(product) {
  const existing = cart.find(item => item.image === product.image);
  if (existing) {
    existing.quantity += 1;
    alert("üõí Item quantity updated in the cart!");
  } else {
    cart.push({ ...product, quantity: 1 });
    alert("‚úÖ Item added to the cart!");
  }
  saveCart();
}

// ‚úÖ Update quantity
function updateQuantity(image, change) {
  const item = cart.find(p => p.image === image);
  if (item) {
    item.quantity += change;
    if (item.quantity <= 0) {
      cart = cart.filter(p => p.image !== image);
    }
    saveCart();
  }
}

// ‚úÖ Render selected product
function renderSelectedProduct(product) {
  selectedProductDiv.innerHTML = `
    <h3 class="text-xl mb-3 text-pink-700 font-medium">Selected Product</h3>
    <div class="bg-white rounded-xl shadow-md p-4 inline-block">
      <img src="${product.image}" alt="${product.name}" 
           class="w-72 h-80 object-cover rounded-lg mx-auto mb-3 border-4 border-pink-500">
      <h4 class="text-pink-700 font-semibold text-lg">${product.name}</h4>
      <p class="text-gray-700">‚Çπ${product.discounted} 
         <del class="text-gray-400 ml-2">‚Çπ${product.original}</del></p>
      <button id="selected-add-btn" 
              class="mt-3 bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg">
        Add to Cart
      </button>
    </div>
  `;
  document.getElementById('selected-add-btn').addEventListener('click', () => addToCart(product));
}

// ‚úÖ Display selected product if passed via URL
if (selectedImage) {
  const selected = allProducts.find(p => p.image === selectedImage);
  if (selected) renderSelectedProduct(selected);
}

// ‚úÖ Render all available products
allProducts.forEach((p, index) => {
  const productCard = document.createElement('div');
  productCard.className = "bg-white rounded-xl shadow hover:shadow-lg transition text-center p-4";
  productCard.innerHTML = `
    <img src="${p.image}" alt="${p.name}" class="mx-auto w-3/4 h-64 object-cover rounded mb-3">
    <h4 class="text-pink-700 font-semibold">${p.name}</h4>
    <p class="text-gray-700 text-sm">
      ‚Çπ${p.discounted} <del class="text-gray-400 ml-1">‚Çπ${p.original}</del>
    </p>
    <button class="buy-btn bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 mt-3 rounded-lg">
      Add to Cart
    </button>
  `;
  productCard.querySelector('.buy-btn').addEventListener('click', () => {
    addToCart(p);
    renderSelectedProduct(p);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  productList.appendChild(productCard);
});

// ‚úÖ Render the session cart
function renderCart() {
  cartItemsDiv.innerHTML = '';
  if (cart.length === 0) {
    cartItemsDiv.innerHTML = `<p class="text-gray-500 italic">Your cart is empty.</p>`;
    return;
  }

  cart.forEach(item => {
    const card = document.createElement('div');
    card.className = "bg-white rounded-xl shadow p-4 text-center";
    card.innerHTML = `
      <img src="${item.image}" alt="${item.name}" class="mx-auto w-40 h-40 object-cover rounded mb-3">
      <h4 class="text-pink-700 font-semibold">${item.name}</h4>
      <p class="text-gray-700 mb-2">‚Çπ${item.discounted}</p>
      <div class="flex justify-center items-center space-x-2 mb-2">
        <button class="bg-gray-200 px-3 py-1 rounded" onclick="updateQuantity('${item.image}', -1)">-</button>
        <span class="font-medium">${item.quantity}</span>
        <button class="bg-gray-200 px-3 py-1 rounded" onclick="updateQuantity('${item.image}', 1)">+</button>
      </div>
      <button class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded" onclick="updateQuantity('${item.image}', -${item.quantity})">
        Remove
      </button>
    `;
    cartItemsDiv.appendChild(card);
  });
}

// ‚úÖ Initial render of cart
renderCart();
</script>

</body>
</html>
